"use strict";var WPForms=window.WPForms||{};WPForms.Admin=WPForms.Admin||{},WPForms.Admin.Builder=WPForms.Admin.Builder||{},WPForms.Admin.Builder.DragFields=WPForms.Admin.Builder.DragFields||function(c){let g={},w={},b;const F={init:function(){c(F.ready)},ready:function(){F.setup(),F.initSortableFields(),F.events()},setup:function(){g={$builder:c("#wpforms-builder"),$sortableFieldsWrap:c("#wpforms-panel-fields .wpforms-field-wrap"),$addFieldsButtons:c(".wpforms-add-fields-button").not(".not-draggable").not(".warning-modal").not(".education-modal")}},events:function(){g.$builder.on("wpformsFieldDragToggle",F.fieldDragToggleEvent)},disableDragAndDrop:function(){g.$addFieldsButtons.filter(".ui-draggable").draggable("disable"),g.$sortableFieldsWrap.sortable("disable"),g.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("disable")},enableDragAndDrop:function(){g.$addFieldsButtons.filter(".ui-draggable").draggable("enable"),g.$sortableFieldsWrap.sortable("enable"),g.$sortableFieldsWrap.find(".wpforms-layout-column.ui-sortable").sortable("enable")},fieldDragDisable:function(e,l=!0){if(e.hasClass("ui-draggable-disabled"))e.draggable("enable");else{let o;e.draggable({revert:!0,axis:"y",delay:100,opacity:.75,cursor:"move",start:function(e,i){o=i.position.top},drag:function(e,i){if(15<Math.abs(i.position.top)-Math.abs(o))return l&&F.youCantReorderFieldPopup(),!1}})}},fieldDragEnable:function(e){e.hasClass("ui-draggable")||e.draggable("disable")},youCantReorderFieldPopup:function(){c.confirm({title:wpforms_builder.heads_up,content:wpforms_builder.field_cannot_be_reordered,icon:"fa fa-exclamation-circle",type:"red",buttons:{confirm:{text:wpforms_builder.ok,btnClass:"btn-confirm",keys:["enter"]}}})},fieldDragToggleEvent:function(e,i){i=c("#wpforms-field-"+i);i.hasClass("wpforms-field-not-draggable")||i.hasClass("wpforms-field-stick")?F.fieldDragDisable(i):F.fieldDragEnable(i)},initSortableFields:function(){F.initSortableContainer(g.$sortableFieldsWrap),g.$builder.find(".wpforms-layout-column").each(function(){F.initSortableContainer(c(this))}),F.fieldDragDisable(c(".wpforms-field-not-draggable, .wpforms-field-stick")),F.initDraggableFields()},initSortableContainer:function(r){const d=c("#wpforms-field-options");let t,a,s,n,f,m,p=c("#wpforms-panel-fields .wpforms-panel-content-wrap"),u=!1;r.sortable({items:"> .wpforms-field:not(.wpforms-field-stick):not(.no-fields-preview)",connectWith:".wpforms-field-wrap, .wpforms-layout-column",delay:100,opacity:.75,cursor:"move",cancel:".wpforms-field-not-draggable",placeholder:"wpforms-field-drag-placeholder",appendTo:"#wpforms-panel-fields",zindex:1e4,tolerance:"pointer",distance:1,start:function(e,i){t=i.item.data("field-id"),a=i.item.data("field-type"),s=void 0===t,n=c("#wpforms-field-option-"+t),w.fieldReceived=!1,w.fieldRejected=!1,w.$sortableStart=r,w.startPosition=i.item.first().index()},beforeStop:function(e,i){!w.glitchChange||b.isFieldAllowedInColum(a)||(w.fieldRejected=!0)},stop:function(e,i){var o,l=i.item.first();i.placeholder.removeClass("wpforms-field-drag-not-allowed"),l.removeClass("wpforms-field-drag-not-allowed"),w.fieldRejected?(F.revertMoveFieldToColumn(l),g.$builder.trigger("wpformsFieldMoveRejected",[l,i])):(m=l.prev(".wpforms-field, .wpforms-alert").data("field-id"),0<(f=c("#wpforms-field-option-"+m)).length?f.after(n):d.prepend(n),!s&&l.closest(".wpforms-layout-column").is(r)&&b.positionFieldInColumn(t,l.index()-1,r),o=l.closest(".wpforms-field-layout"),b.fieldOptionsUpdate(null,t),b.reorderLayoutFieldsOptions(o),s||l.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over"),l.attr("style",""),g.$builder.trigger("wpformsFieldMove",i),w.fieldReceived=!1)},over:function(e,i){var i=i.item.first(),e=c(e.target),o=e.find(".wpforms-field-drag-placeholder"),l=e.hasClass("wpforms-layout-column"),d=l?" wpforms-field-drag-to-column":"",e={width:e.outerWidth(),height:i.outerHeight()};t=i.data("field-id"),a=i.data("field-type")||w.fieldType,s=void 0===t,i.addClass("wpforms-field-dragging"+d).css({width:l?e.width-5:e.width,height:"auto"}),o.removeClass("wpforms-field-drag-not-allowed").css({height:s?e.height+18:e.height}),!b.isFieldAllowedInColum(a)&&l&&(o.addClass("wpforms-field-drag-not-allowed"),i.addClass("wpforms-field-drag-not-allowed")),s&&i.addClass("wpforms-field-drag-over").removeClass("wpforms-field-drag-out")},out:function(e,i){var o=i.item.first(),l=void 0===o.data("field-id");o.removeClass("wpforms-field-drag-not-allowed").removeClass("wpforms-field-drag-to-column"),w.fieldReceived?o.attr("style",""):l?o.addClass("wpforms-field-drag-out").removeClass("wpforms-field-drag-over"):c(i.sender).closest(".wpforms-field-layout").removeClass("wpforms-field-child-hovered")},receive:function(e,i){var o=c(i.helper||i.item),l=(t=o.data("field-id"),a=o.data("field-type")||w.fieldType,void 0===t),d=r.hasClass("wpforms-layout-column");!b.isFieldAllowedInColum(a)&&d?w.fieldRejected=!0:(w.fieldReceived=!0,o.removeClass("wpforms-field-drag-over"),l?(l=r.data("ui-sortable").currentItem.index(),o.addClass("wpforms-field-drag-over wpforms-field-drag-pending").removeClass("wpforms-field-drag-out").append(WPFormsBuilder.settings.spinnerInline).css("width","100%"),g.$builder.find(".wpforms-add-fields .wpforms-add-fields-button").prop("disabled",!0),g.$builder.find(".no-fields-preview").remove(),WPFormsBuilder.fieldAdd(w.fieldType,{position:d?l-1:l,placeholder:o,$sortable:r}),w.fieldType=void 0):b.receiveFieldToColumn(t,i.item.index()-1,o.parent()))},change:function(e,i){i=i.placeholder.parent();w.glitchChange=!1,!r.is(i)&&r.hasClass("wpforms-field-wrap")&&i.hasClass("wpforms-layout-column")&&(w.glitchChange=!0)},sort:function(i,e){if(!u){var i=i.clientY,o=p.offset(),l=p.height(),d=o.top+l;let e;if(i>o.top&&i<o.top+50)e="-=";else{if(!(d-50<i&&i<d))return;e="+="}u=!0,p.animate({scrollTop:e+l/3+"px"},800,function(){u=!1})}}})},initDraggableFields:function(){g.$addFieldsButtons.draggable({connectToSortable:".wpforms-field-wrap, .wpforms-layout-column",delay:200,cancel:!1,scroll:!1,opacity:.75,appendTo:"#wpforms-panel-fields",zindex:1e4,helper:function(){var e=c(this),i=c('<div class="wpforms-field-drag-out wpforms-field-drag">');return w.fieldType=e.data("field-type"),i.html(e.html())},start:function(e,i){if(WPFormsUtils.triggerEvent(g.$builder,"wpformsFieldAddDragStart",[w.fieldType,i]).isDefaultPrevented())return!1}})},revertMoveFieldToColumn:function(e){var i;void 0===e.data("field-id")?e.remove():(e=e.detach(),i=w.$sortableStart.find("> .wpforms-field").eq(w.startPosition),e.removeClass("wpforms-field-dragging").removeClass("wpforms-field-drag-over").attr("style",""),i.length?i.before(e):w.$sortableStart.append(e))}};return b={positionFieldInColumn:function(e,i,o){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.positionFieldInColumn(e,i,o)},receiveFieldToColumn:function(e,i,o){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.receiveFieldToColumn(e,i,o)},fieldOptionsUpdate:function(e,i){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.fieldOptionsUpdate(e,i)},reorderLayoutFieldsOptions:function(e){WPForms.Admin.Builder.FieldLayout&&WPForms.Admin.Builder.FieldLayout.reorderLayoutFieldsOptions(e)},isFieldAllowedInColum:function(e){return!WPForms.Admin.Builder.FieldLayout||WPForms.Admin.Builder.FieldLayout.isFieldAllowedInColum(e)}},F}((document,window,jQuery)),WPForms.Admin.Builder.DragFields.init();